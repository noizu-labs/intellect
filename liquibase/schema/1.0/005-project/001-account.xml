<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:pro="http://www.liquibase.org/xml/ns/pro" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-latest.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">

    <!-- ========================================================== -->
    <!-- Account Tables                                             -->
    <!-- ========================================================== -->
    <changeSet author="kebrings" id="account table">
        <createTable tableName="account">
            <column name="identifier" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_account"/>
            </column>
            <column name="details" remarks="versioned string" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="created_on" type="TIMESTAMP WITHOUT TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="modified_on" type="TIMESTAMP WITHOUT TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="deleted_on" type="TIMESTAMP WITHOUT TIME ZONE"/>
        </createTable>
    </changeSet>

    <!-- ========================================================== -->
    <!-- Account Member Tables                                      -->
    <!-- ========================================================== -->
    <changeSet author="kebrings" id="account_member table">
        <createTable tableName="account_member">
            <column name="identifier" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_account_member"/>
            </column>
            <column name="account" type="BIGINT"/>
            <column name="user" type="BIGINT"/>
            <column name="details" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="created_on" type="TIMESTAMP WITHOUT TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="modified_on" type="TIMESTAMP WITHOUT TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="deleted_on" type="TIMESTAMP WITHOUT TIME ZONE"/>
        </createTable>
    </changeSet>

    <changeSet author="kebrings" id="account_member_role table">
        <createTable tableName="account_member_role">
            <column name="identifier" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_account_member_role"/>
            </column>
            <column name="account_member" type="BIGINT"/>
            <column name="account_role" type="BIGINT"/>
            <column name="details" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="created_on" type="TIMESTAMP WITHOUT TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="modified_on" type="TIMESTAMP WITHOUT TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="deleted_on" type="TIMESTAMP WITHOUT TIME ZONE"/>
        </createTable>
    </changeSet>

    <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
    <!-- User : Indexes                                             -->
    <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->

    <changeSet author="kebrings" id="1689398584253-36">
        <createIndex indexName="IXFK_account_member_account" tableName="account_member">
            <column name="account"/>
        </createIndex>
    </changeSet>

    <changeSet author="kebrings" id="1689398584253-37">
        <createIndex indexName="IXFK_account_member_role_account_member" tableName="account_member_role">
            <column name="account_member"/>
        </createIndex>
    </changeSet>

    <changeSet author="kebrings" id="1689398584253-38">
        <createIndex indexName="IXFK_account_member_user" tableName="account_member">
            <column name="user"/>
        </createIndex>
    </changeSet>


    <!-- .......................................................... -->
    <!-- Account : Foreign Keys                                     -->
    <!-- .......................................................... -->
    <changeSet author="kebrings" id="1689398584253-64">
        <addForeignKeyConstraint baseColumnNames="account" baseTableName="account_member" constraintName="FK_account_member_account" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="identifier" referencedTableName="account" validate="true"/>
    </changeSet>

    <changeSet author="kebrings" id="1689398584253-65">
        <addForeignKeyConstraint baseColumnNames="account_member" baseTableName="account_member_role" constraintName="FK_account_member_role_account_member" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="identifier" referencedTableName="account_member" validate="true"/>
    </changeSet>

    <changeSet author="kebrings" id="1689398584253-66">
        <addForeignKeyConstraint baseColumnNames="user" baseTableName="account_member" constraintName="FK_account_member_user" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="identifier" referencedTableName="user" validate="true"/>
    </changeSet>

</databaseChangeLog>
